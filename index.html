<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Quiz Interactivo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .quiz-container { background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 700px; width: 95%; position: relative; }
        .header-row { display: flex; justify-content: space-between; align-items: start; border-bottom: 2px solid #007bff; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        h1 { color: #333; font-size: 1.4rem; margin: 0; }
        .shuffle-btn { background-color: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; transition: 0.2s; }
        .shuffle-btn:hover { background-color: #5a6268; }
        .score-board { font-size: 0.9rem; color: #555; margin-top: 5px; }
        .question { font-size: 1.2rem; margin-bottom: 1.2rem; font-weight: 600; color: #2c3e50; line-height: 1.4; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .option-btn { padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; text-align: left; transition: all 0.2s; font-size: 1rem; position: relative; }
        .option-btn:hover:not(:disabled) { background-color: #f0f8ff; border-color: #007bff; }
        .option-btn.correct { background-color: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.wrong { background-color: #f8d7da; border-color: #dc3545; color: #721c24; }
        .option-btn.should-have-been { border: 2px dashed #28a745; background-color: #e9f7ef; }
        .option-btn:disabled { cursor: default; opacity: 1; } 
        .feedback { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; font-size: 1rem; line-height: 1.5; }
        .feedback.show { display: block; animation: fadeIn 0.3s; }
        .feedback-correct { background-color: #e9f7ef; border-left: 5px solid #28a745; }
        .feedback-wrong { background-color: #fce8e6; border-left: 5px solid #dc3545; }
        .feedback-info { background-color: #e2e6ea; border-left: 5px solid #6c757d; }
        .controls { margin-top: 30px; display: flex; justify-content: space-between; gap: 10px; padding-top: 15px; border-top: 1px solid #eee; }
        .nav-btn { padding: 10px 25px; border-radius: 5px; cursor: pointer; font-size: 1rem; border: none; font-weight: bold; transition: 0.2s; }
        #prev-btn { background-color: #e2e6ea; color: #333; }
        #prev-btn:hover:not(:disabled) { background-color: #dbe0e5; }
        #prev-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        #next-btn { background-color: #007bff; color: white; } 
        #next-btn:hover { background-color: #0056b3; }
        #next-btn.back-to-results { background-color: #6c757d; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="quiz-container" id="quiz-ui">
    <div class="header-row">
        <div>
            <h1 id="quiz-title-display">Mi Quiz Interactivo</h1>
            <div class="score-board">
                Pregunta <span id="current-q">1</span> de <span id="total-q">0</span> 
                | Puntos actuales: <span id="score-val" style="font-weight: bold; color: #007bff;">0</span>
            </div>
        </div>
        <button class="shuffle-btn" onclick="restartQuizManual()">üîÑ Reiniciar</button>
    </div>
    
    <div id="question-area">
        <div class="question" id="question-text">Cargando...</div>
        <div class="options" id="options-container"></div>
        <div class="feedback" id="feedback-text"></div>
    </div>

    <div class="controls">
        <button id="prev-btn" class="nav-btn" onclick="prevQuestion()">Anterior</button>
        <div style="flex-grow: 1;"></div> 
        <button id="next-btn" class="nav-btn" onclick="nextQuestion()">Siguiente</button>
    </div>
</div>

<div class="quiz-container" id="results-ui" style="display: none; text-align: center;">
    <h1 style="font-size: 2rem; color: #007bff; margin-bottom: 20px;">Quiz Finalizado</h1>
    <div id="final-score-display" style="font-size: 1.5rem; margin: 20px 0;"></div>
    <p id="final-msg-display" style="color: #666; font-size: 1.1rem;"></p>
    
    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
        <button class="nav-btn" style="background-color: #28a745; color: white;" onclick="enterReviewMode()">üîç Revisar Respuestas</button>
        <button class="nav-btn" style="background-color: #007bff; color: white;" onclick="restartQuizManual()">üîÑ Volver a Jugar</button>
    </div>
</div>

<script>
    const quizData = {
    "questions": [
        {
            "question": "¬øQui√©n es considerado el padre de la tecnolog√≠a fotovoltaica en la era contempor√°nea por observar este efecto por primera vez?",
            "answerOptions": [
                {
                    "text": "a) Albert Einstein",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Alexandre-Edmond Becquerel.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "c) Thomas Edison.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øQu√© funci√≥n principal realiza un inversor en una instalaci√≥n fotovoltaica?",
            "answerOptions": [
                {
                    "text": "a) Almacenar la energ√≠a excedente para la noche.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Medir la radiaci√≥n solar global.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Transformar la corriente continua (CC) de los paneles en corriente alterna (CA).",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øcu√°l es el rango de eficiencia actual de los paneles monocristalinos?",
            "answerOptions": [
                {
                    "text": "a) Entre el 7% y el 13%.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Alrededor del 16%.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Entre el 21% y el 23%.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øQu√© es el \"Efecto Clipping\" en el contexto del dimensionamiento de inversores?",
            "answerOptions": [
                {
                    "text": "a) Es el corte de producci√≥n que realiza el inversor cuando la potencia solar supera su capacidad nominal.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "b) Es la p√©rdida de energ√≠a por suciedad en los paneles.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Es el aumento de voltaje debido a las bajas temperaturas.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øQu√© tecnolog√≠a de almacenamiento se perfila como la soluci√≥n ideal para el almacenamiento estacional y a largo plazo?",
            "answerOptions": [
                {
                    "text": "a) Bater√≠as de Litio (BESS).",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Sales Fundidas.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Hidr√≥geno Verde (H2).",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øQu√© significa LCOE y cu√°l es su tendencia actual seg√∫n el trabajo?",
            "answerOptions": [
                {
                    "text": "a) Coste de Oportunidad Energ√©tica; ha subido debido a la inflaci√≥n.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Coste Nivelado de la Energ√≠a; ha ca√≠do un 90% desde 2010.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "c) L√≠mite de Carga Operativa El√©ctrica; se mantiene estable.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "En relaci√≥n con el mantenimiento, ¬øqu√© factor ambiental disminuye el rendimiento de los paneles solares?",
            "answerOptions": [
                {
                    "text": "a) El fr√≠o intenso.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) El calor excesivo (temperaturas muy por encima de 25¬∞C).",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "c) El viento moderado.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øQu√© es la Agrovoltaica?",
            "answerOptions": [
                {
                    "text": "a) El uso de biocombustibles para limpiar paneles.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) La sustituci√≥n de campos de cultivo por plantas solares exclusivamente.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) La combinaci√≥n de cultivos o pastoreo con paneles elevados o verticales en el mismo terreno.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øCu√°nto tiempo se estima que tarda un panel moderno en generar la energ√≠a que cost√≥ fabricarlo (EPBT)?",
            "answerOptions": [
                {
                    "text": "a) Menos de 1 a√±o.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "b) Entre 5 y 7 a√±os.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Aproximadamente 10 a√±os.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øQu√© diferencia principal existe entre la Potencia Pico (Wp) y la Potencia Nominal (Wn)?",
            "answerOptions": [
                {
                    "text": "a) No hay diferencia, son sin√≥nimos.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) La Wp es la del inversor y la Wn es la de los paneles.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) La Wp es la suma de potencia de los m√≥dulos en condiciones est√°ndar y la Wn es la potencia m√°xima de salida del inversor.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øCu√°l es el incremento de producci√≥n estimado de un seguidor solar de un eje frente a una estructura fija?",
            "answerOptions": [
                {
                    "text": "a) Entre un 5% y un 10%.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Entre un 25% y un 30%.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "c) Hasta un 60%.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øQu√© regi√≥n de Espa√±a destaca por tener una media anual superior a las 3.000 horas de sol?",
            "answerOptions": [
                {
                    "text": "a) Galicia.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Pa√≠s Vasco.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Andaluc√≠a.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "En una c√©lula fotovoltaica, ¬øqu√© elemento se utiliza para dopar el silicio y crear la Zona N (negativa)?",
            "answerOptions": [
                {
                    "text": "a) Boro.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) F√≥sforo.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "c) Litio.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øQu√© es la \"Paridad de Red\" en el √°mbito del autoconsumo?",
            "answerOptions": [
                {
                    "text": "a) Cuando el coste de producir tu propia energ√≠a es igual o menor al precio de comprarla de la red.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "b) Cuando la instalaci√≥n est√° desconectada f√≠sicamente de la red el√©ctrica.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Cuando se produce exactamente la misma cantidad de energ√≠a que se consume.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "¬øC√≥mo se clasifican los paneles fotovoltaicos al final de su vida √∫til en Europa?",
            "answerOptions": [
                {
                    "text": "a) Como residuos urbanos comunes.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Como residuos inertes de construcci√≥n.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Como Residuos de Aparatos El√©ctricos y Electr√≥nicos (RAEE).",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øCu√°l de estos tipos de radiaci√≥n NO nos interesa para una instalaci√≥n de energ√≠a solar t√©rmica?",
            "answerOptions": [
                {
                    "text": "a) Radiaci√≥n visible",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Radiaci√≥n ultravioleta",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Radiaci√≥n Gamma.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "Por lo general, ¬øqu√© mezcla se utiliza como fluido caloportador?",
            "answerOptions": [
                {
                    "text": "a) Agua diluida en alcohol.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Gas refrigerante.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Agua y anticongelante.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "¬øQu√© es la energ√≠a solar t√©rmica?",
            "answerOptions": [
                {
                    "text": "a) La energ√≠a que produce electricidad directamente a partir de paneles fotovoltaicos.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) La energ√≠a generada por la combusti√≥n de materiales f√≥siles.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) La energ√≠a que llega del sol en forma de calor y se aprovecha para instalaciones t√©rmicas.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "4. ¬øQu√© funci√≥n cumplen los captadores solares en una instalaci√≥n solar t√©rmica?",
            "answerOptions": [
                {
                    "text": "a) Transformar la radiaci√≥n solar en energ√≠a el√©ctrica.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Absorber la radiaci√≥n y transferir el calor al fluido caloportador.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "d) Refrescar el fluido caloportador antes de enviarlo al dep√≥sito acumulador.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "5. ¬øCu√°l de las siguientes NO es una aplicaci√≥n de la energ√≠a solar t√©rmica?",
            "answerOptions": [
                {
                    "text": "a) Agua caliente sanitaria (ACS).",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "b) Calefacci√≥n por suelo radiante.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "c) Producci√≥n directa de energ√≠a fotovoltaica.",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "1. ¬øCu√°l es un rango t√≠pico de potencia para turbinas offshore instaladas recientemente?",
            "answerOptions": [
                {
                    "text": "A) 0,1 ‚Äì 0,5 MW",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) 3 ‚Äì 4 MW",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "D) 8 ‚Äì 14 MW",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "2. ¬øQu√© t√©cnica es m√°s adecuada para almacenar energ√≠a para uso estacional a gran escala?",
            "answerOptions": [
                {
                    "text": "A) Bater√≠as de Li-ion a peque√±a escala.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "B) Hidr√≥geno o bombeo hidr√°ulico (PHS)",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "C) Regulaci√≥n de frecuencia local.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "3. ¬øQu√© dimensiones necesita un parque a gran escala por cada megavatio instalado?",
            "answerOptions": [
                {
                    "text": "B) Entre 30 y 60 metros de distancia entre turbinas instaladas.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "D) Entre 30 y 60 hect√°reas por cada megavatio instalado",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "C) Entre 3 y 6 campos de f√∫tbol por cada megavatio instalado.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "4. ¬øCu√°les son los tres principales componentes de un aerogenerador?",
            "answerOptions": [
                {
                    "text": "A) La g√≥ndola, control electr√≥nico y eje de alta velocidad.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "B) El buje, veleta y anem√≥metro.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) El rotor, la multiplicadora y el generador",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "5. ¬øQu√© fuerza de la naturaleza aprovecha la energ√≠a e√≥lica?",
            "answerOptions": [
                {
                    "text": "A) Calor",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "B) Luz",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) Viento",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "6. ¬øCu√°l de estas es un sistema de fijaci√≥n de las plataformas Offshore de cimentaci√≥n fija?",
            "answerOptions": [
                {
                    "text": "A) Por camisas de sujeci√≥n.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "B) Por monopilotes",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "C) Por boyas de flotaci√≥n.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "7. ¬øQu√© porcentaje de inversi√≥n respecto del total representa la instalaci√≥n de la turbina de un aerogenerador?",
            "answerOptions": [
                {
                    "text": "A) 0,5%",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "B) 10-15%",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) 65-75%",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "8. Los costes asociados al mantenimiento correctivo (no programado) de un aerogenerador al cabo de 15-20 a√±os:",
            "answerOptions": [
                {
                    "text": "A) Aumentan aproximadamente al doble",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "B) Disminuyen a la mitad.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) Se mantienen iguales.",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "9. Que factores que afectan directamente al rendimiento de un aerogenerador:",
            "answerOptions": [
                {
                    "text": "A) Altura de la torre",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "B) Zona horaria",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) Suelo",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "10. Qu√© Comunidad Aut√≥noma de Espa√±a es la que m√°s energ√≠a e√≥lica produce?",
            "answerOptions": [
                {
                    "text": "A) Madrid",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "B) Castilla la Mancha",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) Castilla Le√≥n",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                }
            ]
        },
        {
            "question": "11. Tipos de obst√°culos que dejan pasar partes del viento:",
            "answerOptions": [
                {
                    "text": "A) Porosos",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "B) No porosos",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) Absolutos",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        },
        {
            "question": "12. Cu√°l de los siguientes es un impacto ambiental de la e√≥lica:",
            "answerOptions": [
                {
                    "text": "A) Fauna",
                    "isCorrect": true,
                    "rationale": "¬°Correcto!"
                },
                {
                    "text": "B) Aviones",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                },
                {
                    "text": "C) Tr√°fico",
                    "isCorrect": false,
                    "rationale": "Incorrecto."
                }
            ]
        }
    ]
};
    const config = {
    "shuffle": true
};

    let currentQuestionIndex = 0;
    let userAnswers = []; 
    let isReviewMode = false;

    const quizUI = document.getElementById('quiz-ui');
    const resultsUI = document.getElementById('results-ui');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const feedbackText = document.getElementById('feedback-text');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const currentQSpan = document.getElementById('current-q');
    const scoreValSpan = document.getElementById('score-val');

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function randomizeData() {
        if (config.shuffle) {
            shuffleArray(quizData.questions);
            quizData.questions.forEach(question => {
                shuffleArray(question.answerOptions);
            });
        }
    }

    function initQuiz() {
        userAnswers = new Array(quizData.questions.length).fill(null);
        document.getElementById('total-q').innerText = quizData.questions.length;
        isReviewMode = false;
        currentQuestionIndex = 0;
        updateScoreUI();
        quizUI.style.display = 'block';
        resultsUI.style.display = 'none';
        loadQuestion();
    }

    function restartQuizManual() {
        if(!confirm("¬øReiniciar el quiz?")) return;
        if(config.shuffle) randomizeData();
        initQuiz();
    }

    function updateScoreUI() {
        let currentScore = 0;
        userAnswers.forEach((ansIndex, qIndex) => {
            if (ansIndex !== null) {
                if (quizData.questions[qIndex].answerOptions[ansIndex].isCorrect) {
                    currentScore++;
                }
            }
        });
        scoreValSpan.innerText = currentScore;
        return currentScore;
    }

    function loadQuestion() {
        const currentQ = quizData.questions[currentQuestionIndex];
        currentQSpan.innerText = currentQuestionIndex + 1;
        prevBtn.disabled = (currentQuestionIndex === 0);
        
        if (currentQuestionIndex === quizData.questions.length - 1) {
            if (isReviewMode) {
                nextBtn.innerText = 'Volver a Resultados';
                nextBtn.classList.add('back-to-results');
            } else {
                nextBtn.innerText = 'Finalizar y Ver Nota';
                nextBtn.classList.remove('back-to-results');
            }
        } else {
            nextBtn.innerText = 'Siguiente';
            nextBtn.classList.remove('back-to-results');
        }

        questionText.innerText = currentQ.question;
        optionsContainer.innerHTML = '';
        feedbackText.className = 'feedback';
        feedbackText.innerHTML = '';
        feedbackText.style.display = 'none';

        currentQ.answerOptions.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            const userIdx = userAnswers[currentQuestionIndex];
            
            if (isReviewMode) {
                btn.disabled = true;
                if (userIdx !== null) {
                    if (index === userIdx) {
                        if (opt.isCorrect) btn.classList.add('correct');
                        else btn.classList.add('wrong');
                    } else if (opt.isCorrect && !currentQ.answerOptions[userIdx].isCorrect) {
                        btn.classList.add('should-have-been');
                    }
                } else {
                    if (opt.isCorrect) btn.classList.add('should-have-been');
                }
            } else {
                if (userIdx !== null) {
                    btn.disabled = true;
                    if (index === userIdx) {
                        if (opt.isCorrect) btn.classList.add('correct');
                        else btn.classList.add('wrong');
                    } else if (opt.isCorrect && !currentQ.answerOptions[userIdx].isCorrect) {
                        btn.classList.add('should-have-been');
                    }
                } else {
                    btn.onclick = () => checkAnswer(opt, index);
                }
            }
            optionsContainer.appendChild(btn);
        });

        const savedIdx = userAnswers[currentQuestionIndex];
        if (savedIdx !== null) {
            const savedOpt = currentQ.answerOptions[savedIdx];
            showFeedbackText(savedOpt, currentQ);
        } else if (isReviewMode) {
            const correctOpt = currentQ.answerOptions.find(o => o.isCorrect);
            feedbackText.style.display = 'block';
            feedbackText.classList.add('show', 'feedback-info');
            feedbackText.innerHTML = `<strong>No contestada.</strong><br>La respuesta correcta era: ${correctOpt.text}<br><em>${correctOpt.rationale}</em>`;
        }
    }

    function checkAnswer(selectedOption, index) {
        userAnswers[currentQuestionIndex] = index;
        updateScoreUI();
        const allBtns = optionsContainer.querySelectorAll('.option-btn');
        const currentQ = quizData.questions[currentQuestionIndex];

        allBtns.forEach((btn, i) => {
            btn.disabled = true;
            const opt = currentQ.answerOptions[i];
            if (i === index) {
                if (opt.isCorrect) btn.classList.add('correct');
                else btn.classList.add('wrong');
            } else {
                if (opt.isCorrect && !selectedOption.isCorrect) {
                    btn.classList.add('should-have-been');
                }
            }
        });
        showFeedbackText(selectedOption, currentQ);
    }

    function showFeedbackText(selectedOpt, currentQ) {
        feedbackText.style.display = 'block';
        feedbackText.classList.add('show');
        if (selectedOpt.isCorrect) {
            feedbackText.classList.add('feedback-correct');
            feedbackText.innerHTML = `<strong>¬°Correcto!</strong><br>${selectedOpt.rationale}`;
        } else {
            const correctOpt = currentQ.answerOptions.find(o => o.isCorrect);
            feedbackText.classList.add('feedback-wrong');
            feedbackText.innerHTML = `<strong>Incorrecto.</strong><br>${selectedOpt.rationale}<br><br><strong>Respuesta correcta:</strong> ${correctOpt.text}`;
        }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            loadQuestion();
        }
    }

    function nextQuestion() {
        if (currentQuestionIndex < quizData.questions.length - 1) {
            currentQuestionIndex++;
            loadQuestion();
        } else {
            if (isReviewMode) {
                showResultsScreen(); 
            } else {
                finishQuiz(); 
            }
        }
    }

    function finishQuiz() {
        const finalScore = updateScoreUI();
        const total = quizData.questions.length;
        const percentage = (finalScore / total) * 100;
        let msg = '';
        if (percentage === 100) msg = '¬°Perfecto!';
        else if (percentage >= 50) msg = 'Has aprobado.';
        else msg = 'Sigue practicando.';

        const unanswered = userAnswers.filter(u => u === null).length;
        if(unanswered > 0) msg += `<br><small>(Dejaste ${unanswered} preguntas sin contestar)</small>`;

        document.getElementById('final-score-display').innerHTML = `Has acertado <strong>${finalScore}</strong> de <strong>${total}</strong>`;
        document.getElementById('final-msg-display').innerHTML = msg;
        showResultsScreen();
    }

    function showResultsScreen() {
        quizUI.style.display = 'none';
        resultsUI.style.display = 'block';
    }

    function enterReviewMode() {
        isReviewMode = true;
        currentQuestionIndex = 0;
        resultsUI.style.display = 'none';
        quizUI.style.display = 'block';
        loadQuestion();
    }

    randomizeData();
    initQuiz();
</script>
</body>
</html>
